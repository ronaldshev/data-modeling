select t1.matches, t1.movieid, t1.moviename from (select count(*) as matches, movies.movieid, movies.movieName from movies inner join moviegenre on movies.movieid = moviegenre.movieid where id in (select moviegenre.id from moviegenre, movies where movies.movieid = " + movieid + " and movies.movieid = moviegenre.movieid) and movies.movieid != " + movieid + " group by movies.movieid order by matches desc, movies.rating desc, movies.popularity desc) t1 inner join (select count(*) as matches, movies.movieid, movies.movieName from movies inner join moviekeyword on movies.movieid = moviekeyword.movieid where id in (select moviekeyword.id from moviekeyword, movies where movies.movieid = " + movieid + " and movies.movieid = moviekeyword.movieid) and movies.movieid != " + movieid + " group by movies.movieid order by matches desc, movies.rating desc, movies.popularity) t2 on (t1.movieid = t2.movieid) limit 5;
